[workspace]
members  = ["crates/baicie_binding", "crates/baicie_json_diff"]
resolver = "3"

  [workspace.package]
  edition    = "2024"
  homepage   = "https://github.com/baicie/tools"
  license    = "MIT"
  repository = "https://github.com/baicie/tools"

  [workspace.lints.clippy]
  # Guidelines
  # - We should only disable rules globally if they are either false positives, chaotic, or does not make sense.
  # - Group are enabled with priority -1, so we could easily override some specific rules.
  #   - https://doc.rust-lang.org/stable/cargo/reference/manifest.html#the-lints-section

  # --- restriction https://doc.rust-lang.org/clippy/usage.html#clippyrestriction
  allow_attributes = "deny"
  dbg_macro        = "deny"
  print_stdout     = "deny"

  # I like the explicitness of this rule as it removes confusion around `clone`.
  # This increases readability, avoids `clone` mindlessly and heap allocating on accident.
  clone_on_ref_ptr                = "deny"
  empty_drop                      = "deny"
  exit                            = "deny"
  filetype_is_file                = "deny"
  get_unwrap                      = "deny"
  rc_buffer                       = "deny"
  rc_mutex                        = "deny"
  rest_pat_in_fully_bound_structs = "deny"
  unnecessary_safety_comment      = "deny"

  # --- pedantic #https://doc.rust-lang.org/clippy/usage.html#clippypedantic
  # To write the best rust code, pedantic group is enabled by default.
  case_sensitive_file_extension_comparisons = "allow"
  pedantic                                  = { level = "deny", priority = -1 }

  # Wizards, naming is too hard.
  module_inception        = "allow"
  module_name_repetitions = "allow"
  similar_names           = "allow"

  # Forwarding `Result` is a common pattern, this rule is too pedantic.
  missing_errors_doc = "allow"

  # #[must_use] is creating too much noise for this codebase, it does not add much value except nagging
  # the programmer to add a #[must_use] after clippy has been run.
  # Having #[must_use] everywhere also hinders readability.
  must_use_candidate = "allow"

  doc_markdown         = "allow"
  missing_const_for_fn = "allow"
  needless_for_each    = "allow"
  new_without_default  = "allow"
  # TODO: should review this rule.
  missing_panics_doc = "allow"

  # Order doesn't really matter https://rust-lang.github.io/rust-clippy/master/index.html#/inconsistent_struct_constructor
  inconsistent_struct_constructor = "allow"

  # Single match is equally readable as if/else. https://rust-lang.github.io/rust-clippy/master/index.html#/single_match
  single_match      = "allow"
  single_match_else = "allow"

  # Though the following are nursery rules, theyâ€™re still useful.
  debug_assert_with_mut_call    = "warn"
  iter_on_single_items          = "warn"
  needless_pass_by_ref_mut      = "warn"
  redundant_clone               = "warn"
  redundant_pub_crate           = "warn"
  significant_drop_in_scrutinee = "warn"
  unused_peekable               = "warn"

  # Rewriting `unwrap_or` to `map_or` requires to annotate type explicitly which is cumbersome
  map_unwrap_or = "allow"

  collapsible_if = "allow"

  [workspace.dependencies]
  # napi
  napi = { version = "3.0.0", features = ["async", "anyhow", "tracing"] }
  napi-build = { version = "2.2.2" }
  napi-derive = { version = "3.0.0", default-features = false, features = [
    "type-def",
    "tracing",
  ] }

[profile.dev]
# Minimal debug info to speed up local and CI builds.
debug = "line-tables-only"

[profile.test]
# Minimal debug info to speed up local and CI builds.
debug = "line-tables-only"

[profile.release]
codegen-units = 1
debug         = false     # Set to `true` for debug information
lto           = "fat"
opt-level     = 3
strip         = "symbols" # Set to `false` for debug information

[profile.release-debug]
debug    = true
inherits = "release"

[profile.profile]
debug    = "line-tables-only"
inherits = "release"
lto      = "thin"
strip    = false

[profile.release-wasi]
inherits  = "release"
opt-level = "s"
# napi-rs generates *-debug.*.wasm files with these information
# it will strip these information for non-debug files
debug = "full"
strip = "none"
